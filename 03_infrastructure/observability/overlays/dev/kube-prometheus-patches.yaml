apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: kube-prometheus-stack
  namespace: monitoring
spec:
  values:
    alertmanager:
      alertmanagerSpec:
        replicas: 2
        retention: 120h
        storage:
          volumeClaimTemplate:
            spec:
              storageClassName: local-path
              accessModes: [ "ReadWriteOnce" ]
              resources:
                requests:
                  storage: 2700Mi
        externalUrl: "https://alertmanager.${BASE_DOMAIN}"

    ## Component scraping the kube controller manager
    ##
    kubeControllerManager:
      endpoints:
        - 10.42.0.1
#        - 192.168.0.12
#        - 192.168.0.13
#      # - 10.141.4.23
#      # - 10.141.4.24

    kubeProxy:
      enabled: false

    prometheus:
      prometheusSpec:
        externalUrl: "https://prometheus.${BASE_DOMAIN}"
        replicas: 2
        storageSpec:
          volumeClaimTemplate:
            spec:
              storageClassName: local-path
              accessModes: [ "ReadWriteOnce" ]
              resources:
                requests:
                  storage: 2700Mi
