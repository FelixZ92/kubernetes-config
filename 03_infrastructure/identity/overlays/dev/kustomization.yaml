resources:
  - ../../base

namespace: keycloak

patches:
  - target:
      kind: IngressRoute
      name: keycloak
    patch: |-
      - op: add
        path: /spec/routes
        value:
          - match: Host(`keycloak.host.k3d.internal`)
            kind: Rule
            services:
              - name: keycloak-http
                port: 80
            middlewares:
              - name: redirect-https
  - target:
      kind: IngressRoute
      name: keycloak-tls
    patch: |-
      - op: add
        path: /spec/routes
        value:
          - match: Host(`keycloak.host.k3d.internal`)
            kind: Rule
            services:
              - name: keycloak-http
                port: 80
