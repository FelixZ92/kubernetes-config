apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-cm
data:
  repositories: |
    - type: helm
      url: https://releases.rancher.com/server-charts/stable
      name: rancher
    - type: helm
      url: https://kubernetes-charts.storage.googleapis.com
      name: stable
    - type: helm
      url: https://containous.github.io/traefik-helm-chart
      name: traefik
  configManagementPlugins: |
    - name: kustomized-helm
      init:
        command: ["/bin/sh", "-c"]
        args: ["helm dependency up ."]
      generate:
        command: [sh, -c]
        args: ["helm template $ARGOCD_APP_NAME . --namespace $ARGOCD_APP_NAMESPACE > base/all.yaml && kustomize build $ENVIRONMENT"]
