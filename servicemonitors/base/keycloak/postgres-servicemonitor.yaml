apiVersion: v1
kind: Service
metadata:
  name: identity-pg-0-metrics
  labels:
    application: spilo
    cluster-name: identity-pg
    statefulset.kubernetes.io/pod-name: identity-pg-0
    team: identity
spec:
  selector:
    application: spilo
    cluster-name: identity-pg
  ports:
    - port: 9187
      name: exporter
      protocol: TCP
      targetPort: exporter
  type: ClusterIP
---
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  labels:
    application: spilo
    cluster-name: identity-pg
    team: identity
    statefulset.kubernetes.io/pod-name: identity-pg-0
    release: prometheus-operator
  name: identity-pg-0
spec:
  endpoints:
    - path: /metrics
      port: exporter
      honorLabels: true
      l
  selector:
    matchLabels:
      application: spilo
      cluster-name: identity-pg
      team: identity
      statefulset.kubernetes.io/pod-name: identity-pg-0
