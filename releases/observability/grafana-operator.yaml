---
apiVersion: helm.fluxcd.io/v1
kind: HelmRelease
metadata:
  name: grafana-operator
  namespace: observability
  annotations:
    fluxcd.io/automated: "false"
spec:
  releaseName: grafana-operator
  chart:
    repository: https://felixz92.gitlab.io/charts
    name: grafana-operator
    version: 0.2.1
  values:
    grafana-operator:
      resources:
        limits:
          cpu: 100m
          memory: 128Mi
        requests:
        cpu: 100m
        memory: 128Mi
      serviceMonitor:
        create: true
      grafana:
        create: false
    grafanaDataSources:
      - resourceNamePostfix: prometheus-datasource
        spec:
          name: prometheus.yaml
          datasources:
            - name: Prometheus
              type: prometheus
              access: proxy
              url: http://monitoring-prometheus-oper-prometheus:9090
              isDefault: true
#      - resourceNamePostfix: loki-datasource
#        spec:
#          name: loki.yaml
#          datasources:
#            - name: Loki
#              type: loki
#              access: proxy
#              url: http://{{(include "loki.serviceName" .)}}:{{ .Values.loki.service.port }}
#              version: 1
